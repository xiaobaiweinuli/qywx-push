# ğŸ§ª æµ‹è¯•æ¸…å•

## æœ¬åœ°æµ‹è¯•ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

### 1ï¸âƒ£ å¯åŠ¨æœåŠ¡

```bash
npm run dev
```

é¢„æœŸç»“æœï¼š
- âœ… æœåŠ¡å¯åŠ¨åœ¨ `http://localhost:8788`
- âœ… æ§åˆ¶å°æ— é”™è¯¯ä¿¡æ¯

### 2ï¸âƒ£ æµ‹è¯•é™æ€é¡µé¢

è®¿é—®ä»¥ä¸‹é¡µé¢ï¼Œç¡®è®¤å¯ä»¥æ­£å¸¸åŠ è½½ï¼š

- [ ] http://localhost:8788/ ï¼ˆé¦–é¡µï¼‰
- [ ] http://localhost:8788/message-sender.html ï¼ˆæ¶ˆæ¯å‘é€ï¼‰
- [ ] http://localhost:8788/message-viewer.html ï¼ˆæ¶ˆæ¯æŸ¥çœ‹ï¼‰
- [ ] http://localhost:8788/api-docs.html ï¼ˆAPI æ–‡æ¡£ï¼‰
- [ ] http://localhost:8788/enhanced-api-docs.html ï¼ˆå¢å¼º APIï¼‰

### 3ï¸âƒ£ æµ‹è¯• API ç«¯ç‚¹

#### åˆ›å»ºé…ç½®

```bash
curl -X POST http://localhost:8788/api/configure \
  -H "Content-Type: application/json" \
  -d '{
    "corpid": "test-corpid",
    "corpsecret": "test-secret",
    "agentid": 1000001,
    "touser": ["user1"],
    "description": "æµ‹è¯•é…ç½®"
  }'
```

é¢„æœŸç»“æœï¼š
- [ ] è¿”å› JSON åŒ…å« `code` å­—æ®µ
- [ ] çŠ¶æ€ç  201

#### è·å–é…ç½®

```bash
curl http://localhost:8788/api/configuration/YOUR_CODE
```

é¢„æœŸç»“æœï¼š
- [ ] è¿”å›é…ç½®ä¿¡æ¯
- [ ] çŠ¶æ€ç  200

#### å‘é€æ¶ˆæ¯ï¼ˆéœ€è¦çœŸå®é…ç½®ï¼‰

```bash
curl -X POST http://localhost:8788/api/notify/YOUR_CODE \
  -H "Content-Type: application/json" \
  -d '{
    "title": "æµ‹è¯•",
    "content": "è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯"
  }'
```

é¢„æœŸç»“æœï¼š
- [ ] è¿”å›æˆåŠŸå“åº”
- [ ] ä¼ä¸šå¾®ä¿¡æ”¶åˆ°æ¶ˆæ¯

### 4ï¸âƒ£ æµ‹è¯•å‰ç«¯äº¤äº’

1. **æ‰“å¼€é¦–é¡µ** http://localhost:8788/
2. **æ‰“å¼€å¼€å‘è€…å·¥å…·**ï¼ˆF12ï¼‰
3. **å¡«å†™é…ç½®ä¿¡æ¯**ï¼š
   - CorpID
   - å›è°ƒ Token
   - EncodingAESKey
4. **ç‚¹å‡»"ç”Ÿæˆå›è°ƒURL"**

æ£€æŸ¥ï¼š
- [ ] Network æ ‡ç­¾æ˜¾ç¤º POST è¯·æ±‚åˆ° `/api/generate-callback`
- [ ] è¯·æ±‚çŠ¶æ€ç  200 æˆ– 201
- [ ] é¡µé¢æ˜¾ç¤ºç”Ÿæˆçš„ Code å’Œå›è°ƒ URL
- [ ] æ—  JavaScript é”™è¯¯

5. **ç»§ç»­å®Œå–„é…ç½®**ï¼š
   - å¡«å†™ CorpSecret
   - å¡«å†™ AgentID
   - ç‚¹å‡»"éªŒè¯å¹¶è·å–æˆå‘˜åˆ—è¡¨"

æ£€æŸ¥ï¼š
- [ ] Network æ ‡ç­¾æ˜¾ç¤º POST è¯·æ±‚åˆ° `/api/validate`
- [ ] è¿”å›æˆå‘˜åˆ—è¡¨
- [ ] å¯ä»¥é€‰æ‹©æˆå‘˜

6. **å®Œæˆé…ç½®**

æ£€æŸ¥ï¼š
- [ ] POST è¯·æ±‚åˆ° `/api/complete-config`
- [ ] æ˜¾ç¤ºæœ€ç»ˆçš„ API åœ°å€

### 5ï¸âƒ£ æµ‹è¯•æ¶ˆæ¯å‘é€é¡µé¢

1. **æ‰“å¼€æ¶ˆæ¯å‘é€é¡µé¢** http://localhost:8788/message-sender.html
2. **è¾“å…¥é…ç½® Code**
3. **å‘é€æ–‡æœ¬æ¶ˆæ¯**

æ£€æŸ¥ï¼š
- [ ] POST è¯·æ±‚åˆ° `/api/notify/:code`
- [ ] è¿”å›æˆåŠŸå“åº”
- [ ] é¡µé¢æ˜¾ç¤ºå‘é€ç»“æœ

4. **æµ‹è¯•å…¶ä»–æ¶ˆæ¯ç±»å‹**ï¼š
   - [ ] æ–‡æœ¬å¡ç‰‡
   - [ ] Markdown
   - [ ] å›¾æ–‡æ¶ˆæ¯

---

## Cloudflare Pages éƒ¨ç½²æµ‹è¯•

### 1ï¸âƒ£ éƒ¨ç½²éªŒè¯

```bash
npm run deploy
```

é¢„æœŸç»“æœï¼š
- [ ] éƒ¨ç½²æˆåŠŸ
- [ ] è·å¾—éƒ¨ç½² URLï¼ˆå¦‚ `https://wechat-notifier.pages.dev`ï¼‰

### 2ï¸âƒ£ æµ‹è¯•é™æ€é¡µé¢

è®¿é—®ä»¥ä¸‹é¡µé¢ï¼š

- [ ] https://your-project.pages.dev/
- [ ] https://your-project.pages.dev/message-sender.html
- [ ] https://your-project.pages.dev/message-viewer.html
- [ ] https://your-project.pages.dev/api-docs.html

### 3ï¸âƒ£ æµ‹è¯• API ç«¯ç‚¹

#### å¥åº·æ£€æŸ¥

```bash
curl https://your-project.pages.dev/
```

é¢„æœŸç»“æœï¼š
- [ ] è¿”å› HTML å†…å®¹
- [ ] çŠ¶æ€ç  200

#### åˆ›å»ºé…ç½®

```bash
curl -X POST https://your-project.pages.dev/api/configure \
  -H "Content-Type: application/json" \
  -d '{
    "corpid": "your-real-corpid",
    "corpsecret": "your-real-secret",
    "agentid": 1000001,
    "touser": ["user1"],
    "description": "ç”Ÿäº§ç¯å¢ƒæµ‹è¯•"
  }'
```

é¢„æœŸç»“æœï¼š
- [ ] è¿”å› JSON åŒ…å« `code`
- [ ] çŠ¶æ€ç  201
- [ ] æ•°æ®ä¿å­˜åˆ° D1 æ•°æ®åº“

#### éªŒè¯æ•°æ®åº“

```bash
wrangler d1 execute wechat-notifier-db \
  --command "SELECT * FROM configurations LIMIT 5"
```

é¢„æœŸç»“æœï¼š
- [ ] æ˜¾ç¤ºåˆšåˆ›å»ºçš„é…ç½®
- [ ] æ•°æ®å®Œæ•´

### 4ï¸âƒ£ æµ‹è¯•å‰ç«¯äº¤äº’ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

1. **æ‰“å¼€ç”Ÿäº§ç¯å¢ƒé¦–é¡µ**
2. **æ‰“å¼€å¼€å‘è€…å·¥å…·**ï¼ˆF12ï¼‰
3. **åˆ›å»ºæ–°é…ç½®**

æ£€æŸ¥ï¼š
- [ ] API è¯·æ±‚ URL æ˜¯ `https://your-project.pages.dev/api/...`
- [ ] è¯·æ±‚æˆåŠŸ
- [ ] æ—  CORS é”™è¯¯
- [ ] æ—  JavaScript é”™è¯¯

4. **æµ‹è¯•æ¶ˆæ¯å‘é€**

æ£€æŸ¥ï¼š
- [ ] æ¶ˆæ¯æˆåŠŸå‘é€
- [ ] ä¼ä¸šå¾®ä¿¡æ”¶åˆ°æ¶ˆæ¯
- [ ] å“åº”æ—¶é—´ < 1 ç§’

### 5ï¸âƒ£ æ€§èƒ½æµ‹è¯•

ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„ Network æ ‡ç­¾ï¼š

- [ ] é¦–é¡µåŠ è½½æ—¶é—´ < 2 ç§’
- [ ] API å“åº”æ—¶é—´ < 500ms
- [ ] é™æ€èµ„æºä» CDN åŠ è½½

### 6ï¸âƒ£ å…¨çƒè®¿é—®æµ‹è¯•

ä½¿ç”¨ [WebPageTest](https://www.webpagetest.org/) æµ‹è¯•ï¼š

- [ ] åŒ—ç¾è®¿é—®é€Ÿåº¦
- [ ] æ¬§æ´²è®¿é—®é€Ÿåº¦
- [ ] äºšæ´²è®¿é—®é€Ÿåº¦

é¢„æœŸï¼šæ‰€æœ‰åœ°åŒºå“åº”æ—¶é—´ < 1 ç§’

---

## åŠŸèƒ½å®Œæ•´æ€§æµ‹è¯•

### é…ç½®ç®¡ç†

- [ ] åˆ›å»ºé…ç½®
- [ ] æŸ¥è¯¢é…ç½®
- [ ] æ›´æ–°é…ç½®
- [ ] éªŒè¯å‡­è¯
- [ ] è·å–æˆå‘˜åˆ—è¡¨

### æ¶ˆæ¯å‘é€

- [ ] æ–‡æœ¬æ¶ˆæ¯
- [ ] æ–‡æœ¬å¡ç‰‡
- [ ] Markdown æ¶ˆæ¯
- [ ] å›¾æ–‡æ¶ˆæ¯
- [ ] æ–‡ä»¶ä¸Šä¼ ï¼ˆéœ€è¦ R2 é…ç½®ï¼‰

### æ¶ˆæ¯æŸ¥è¯¢

- [ ] æŸ¥è¯¢æ¶ˆæ¯åˆ—è¡¨
- [ ] åˆ†é¡µæŸ¥è¯¢
- [ ] æŒ‰æ—¥æœŸç­›é€‰
- [ ] æŒ‰ç±»å‹ç­›é€‰
- [ ] å…³é”®è¯æœç´¢
- [ ] æ¶ˆæ¯ç»Ÿè®¡

### ä¼ä¸šå¾®ä¿¡å›è°ƒ

- [ ] å›è°ƒ URL éªŒè¯
- [ ] æ¥æ”¶æ–‡æœ¬æ¶ˆæ¯
- [ ] æ¥æ”¶å›¾ç‰‡æ¶ˆæ¯
- [ ] æ¶ˆæ¯è§£å¯†
- [ ] æ¶ˆæ¯å­˜å‚¨

---

## å®‰å…¨æ€§æµ‹è¯•

### æ•°æ®åŠ å¯†

- [ ] CorpSecret åŠ å¯†å­˜å‚¨
- [ ] EncodingAESKey åŠ å¯†å­˜å‚¨
- [ ] è§£å¯†åŠŸèƒ½æ­£å¸¸

### è®¿é—®æ§åˆ¶

- [ ] æ— æ•ˆ Code è¿”å› 404
- [ ] ç¼ºå°‘å‚æ•°è¿”å› 400
- [ ] é”™è¯¯å¤„ç†æ­£ç¡®

### CORS é…ç½®

- [ ] OPTIONS è¯·æ±‚æ­£å¸¸
- [ ] CORS å¤´æ­£ç¡®è®¾ç½®
- [ ] è·¨åŸŸè¯·æ±‚æˆåŠŸ

---

## é”™è¯¯å¤„ç†æµ‹è¯•

### å®¢æˆ·ç«¯é”™è¯¯

- [ ] ç¼ºå°‘å¿…å¡«å‚æ•° â†’ 400
- [ ] æ— æ•ˆçš„ Code â†’ 404
- [ ] æ— æ•ˆçš„ JSON â†’ 400

### æœåŠ¡å™¨é”™è¯¯

- [ ] æ•°æ®åº“è¿æ¥å¤±è´¥ â†’ 500
- [ ] ä¼ä¸šå¾®ä¿¡ API å¤±è´¥ â†’ 500
- [ ] åŠ å¯†è§£å¯†å¤±è´¥ â†’ 500

### é”™è¯¯å“åº”æ ¼å¼

æ£€æŸ¥æ‰€æœ‰é”™è¯¯å“åº”åŒ…å«ï¼š
- [ ] `error` å­—æ®µ
- [ ] `timestamp` å­—æ®µ
- [ ] æ­£ç¡®çš„ HTTP çŠ¶æ€ç 

---

## ç›‘æ§å’Œæ—¥å¿—

### æŸ¥çœ‹æ—¥å¿—

```bash
wrangler pages deployment tail
```

æ£€æŸ¥ï¼š
- [ ] è¯·æ±‚æ—¥å¿—æ­£å¸¸
- [ ] é”™è¯¯æ—¥å¿—æ¸…æ™°
- [ ] æ€§èƒ½æŒ‡æ ‡å¯è§

### æ•°æ®åº“ç›‘æ§

```bash
# æŸ¥è¯¢é…ç½®æ•°é‡
wrangler d1 execute wechat-notifier-db \
  --command "SELECT COUNT(*) FROM configurations"

# æŸ¥è¯¢æ¶ˆæ¯æ•°é‡
wrangler d1 execute wechat-notifier-db \
  --command "SELECT COUNT(*) FROM received_messages"
```

---

## å›å½’æµ‹è¯•

æ¯æ¬¡æ›´æ–°åè¿è¡Œï¼š

- [ ] æ‰€æœ‰ API ç«¯ç‚¹æ­£å¸¸
- [ ] å‰ç«¯é¡µé¢æ­£å¸¸
- [ ] æ•°æ®åº“æ“ä½œæ­£å¸¸
- [ ] ç¼“å­˜åŠŸèƒ½æ­£å¸¸
- [ ] æ— æ–°çš„é”™è¯¯æˆ–è­¦å‘Š

---

## å‹åŠ›æµ‹è¯•ï¼ˆå¯é€‰ï¼‰

ä½¿ç”¨ [k6](https://k6.io/) æˆ– [Apache Bench](https://httpd.apache.org/docs/2.4/programs/ab.html)ï¼š

```bash
# æµ‹è¯• API å¹¶å‘
ab -n 1000 -c 10 https://your-project.pages.dev/api/configuration/YOUR_CODE
```

é¢„æœŸï¼š
- [ ] æˆåŠŸç‡ > 99%
- [ ] å¹³å‡å“åº”æ—¶é—´ < 500ms
- [ ] æ— è¶…æ—¶é”™è¯¯

---

## âœ… æµ‹è¯•é€šè¿‡æ ‡å‡†

### æœ¬åœ°å¼€å‘

- âœ… æ‰€æœ‰é™æ€é¡µé¢å¯è®¿é—®
- âœ… æ‰€æœ‰ API ç«¯ç‚¹æ­£å¸¸
- âœ… å‰ç«¯äº¤äº’æ— é”™è¯¯
- âœ… æ•°æ®åº“æ“ä½œæ­£å¸¸

### ç”Ÿäº§ç¯å¢ƒ

- âœ… éƒ¨ç½²æˆåŠŸ
- âœ… å…¨çƒè®¿é—®æ­£å¸¸
- âœ… æ€§èƒ½è¾¾æ ‡ï¼ˆå“åº”æ—¶é—´ < 1sï¼‰
- âœ… æ—  CORS é”™è¯¯
- âœ… æ•°æ®æŒä¹…åŒ–æ­£å¸¸
- âœ… é”™è¯¯å¤„ç†æ­£ç¡®

### åŠŸèƒ½å®Œæ•´æ€§

- âœ… æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å¯ç”¨
- âœ… å‰ç«¯é¡µé¢å®Œå…¨å¯ç”¨
- âœ… API è°ƒç”¨æˆåŠŸ
- âœ… ä¼ä¸šå¾®ä¿¡é›†æˆæ­£å¸¸

---

**ä¼ä¸šå¾®ä¿¡é€šçŸ¥æœåŠ¡** | å®Œæ•´æµ‹è¯• Â· è´¨é‡ä¿è¯ Â· ç¨³å®šå¯é 
