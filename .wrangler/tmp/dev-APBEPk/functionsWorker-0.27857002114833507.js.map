{
  "version": 3,
  "sources": ["../bundle-gY6UX1/checked-fetch.js", "../pages-8wN9vG/bundle-cyJMpS/checked-fetch.js", "../../src/core/database-cf.js", "../../src/core/crypto-cf.js", "../../src/services/notifier-cf.js", "../../functions/api/notify/%255Bcode%255D/enhanced.js", "../../functions/api/callback/%255Bcode%255D.js", "../../functions/api/configuration/%255Bcode%255D.js", "../../functions/api/messages/%255Bcode%255D.js", "../../functions/api/notify/%255Bcode%255D.js", "../../functions/api/configure.js", "../../functions/api/validate.js", "../../functions/_middleware.js", "../pages-8wN9vG/functionsWorker-0.27857002114833507.mjs/functionsRoutes-0.5485049416080252.mjs", "../pages-8wN9vG/functionsWorker-0.27857002114833507.mjs/file:/C:/Users/15268/AppData/Roaming/npm/node_modules/wrangler/node_modules/path-to-regexp/src/index.ts", "../pages-8wN9vG/functionsWorker-0.27857002114833507.mjs/file:/C:/Users/15268/AppData/Roaming/npm/node_modules/wrangler/templates/pages-template-worker.ts", "../pages-8wN9vG/functionsWorker-0.27857002114833507.mjs/file:/C:/Users/15268/AppData/Roaming/npm/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../pages-8wN9vG/functionsWorker-0.27857002114833507.mjs/file:/C:/Users/15268/AppData/Roaming/npm/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../pages-8wN9vG/bundle-cyJMpS/middleware-insertion-facade.js", "../pages-8wN9vG/functionsWorker-0.27857002114833507.mjs/file:/C:/Users/15268/AppData/Roaming/npm/node_modules/wrangler/templates/middleware/common.ts", "../pages-8wN9vG/bundle-cyJMpS/middleware-loader.entry.ts", "file:///C:/Users/15268/AppData/Roaming/npm/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "file:///C:/Users/15268/AppData/Roaming/npm/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-gY6UX1/middleware-insertion-facade.js", "file:///C:/Users/15268/AppData/Roaming/npm/node_modules/wrangler/templates/middleware/common.ts", "../bundle-gY6UX1/middleware-loader.entry.ts"],
  "sourceRoot": "D:\\15268\\Desktop\\qywx-push\\.wrangler\\tmp\\dev-APBEPk",
  "sourcesContent": ["const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "/**\r\n * Cloudflare D1 \u6570\u636E\u5E93\u64CD\u4F5C\u6A21\u5757\r\n * \u9002\u914D D1 \u6570\u636E\u5E93\u7684 API\r\n */\r\n\r\nexport class DatabaseCF {\r\n    constructor(db) {\r\n        this.db = db;\r\n    }\r\n\r\n    // \u521D\u59CB\u5316\u6570\u636E\u5E93\u8868\u7ED3\u6784\r\n    async init() {\r\n        try {\r\n            // \u521B\u5EFA configurations \u8868\r\n            await this.db.prepare(`\r\n                CREATE TABLE IF NOT EXISTS configurations (\r\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n                    code TEXT UNIQUE NOT NULL,\r\n                    corpid TEXT NOT NULL,\r\n                    encrypted_corpsecret TEXT NOT NULL,\r\n                    agentid INTEGER NOT NULL,\r\n                    touser TEXT NOT NULL,\r\n                    description TEXT,\r\n                    callback_token TEXT,\r\n                    encrypted_encoding_aes_key TEXT,\r\n                    callback_enabled BOOLEAN DEFAULT 0,\r\n                    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n                    UNIQUE(corpid, agentid, touser)\r\n                )\r\n            `).run();\r\n\r\n            // \u521B\u5EFA received_messages \u8868\r\n            await this.db.prepare(`\r\n                CREATE TABLE IF NOT EXISTS received_messages (\r\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n                    message_id TEXT UNIQUE NOT NULL,\r\n                    from_user TEXT NOT NULL,\r\n                    from_user_name TEXT,\r\n                    to_user TEXT,\r\n                    agent_id TEXT,\r\n                    msg_type TEXT NOT NULL,\r\n                    content TEXT,\r\n                    media_id TEXT,\r\n                    pic_url TEXT,\r\n                    file_name TEXT,\r\n                    file_size INTEGER,\r\n                    quote_msg_id TEXT,\r\n                    quote_content TEXT,\r\n                    quote_from_user TEXT,\r\n                    quote_from_user_name TEXT,\r\n                    quote_msg_type TEXT,\r\n                    event_type TEXT,\r\n                    event_key TEXT,\r\n                    created_at INTEGER NOT NULL,\r\n                    created_time TEXT NOT NULL,\r\n                    created_date TEXT NOT NULL,\r\n                    is_reply INTEGER DEFAULT 0,\r\n                    is_read INTEGER DEFAULT 0,\r\n                    config_code TEXT NOT NULL,\r\n                    format TEXT,\r\n                    recognition TEXT,\r\n                    thumb_media_id TEXT,\r\n                    location_x REAL,\r\n                    location_y REAL,\r\n                    scale REAL,\r\n                    label TEXT,\r\n                    title TEXT,\r\n                    description TEXT,\r\n                    url TEXT,\r\n                    app_type TEXT\r\n                )\r\n            `).run();\r\n\r\n            // \u521B\u5EFA\u7D22\u5F15\r\n            const indexes = [\r\n                'CREATE INDEX IF NOT EXISTS idx_from_user ON received_messages(from_user)',\r\n                'CREATE INDEX IF NOT EXISTS idx_created_at ON received_messages(created_at)',\r\n                'CREATE INDEX IF NOT EXISTS idx_created_date ON received_messages(created_date)',\r\n                'CREATE INDEX IF NOT EXISTS idx_msg_type ON received_messages(msg_type)',\r\n                'CREATE INDEX IF NOT EXISTS idx_config_code ON received_messages(config_code)',\r\n                'CREATE INDEX IF NOT EXISTS idx_composite ON received_messages(from_user, created_at)'\r\n            ];\r\n\r\n            for (const indexSql of indexes) {\r\n                await this.db.prepare(indexSql).run();\r\n            }\r\n\r\n            console.log('\u2705 D1 \u6570\u636E\u5E93\u521D\u59CB\u5316\u6210\u529F');\r\n        } catch (error) {\r\n            console.error('\u274C D1 \u6570\u636E\u5E93\u521D\u59CB\u5316\u5931\u8D25:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    // \u4FDD\u5B58\u914D\u7F6E\r\n    async saveConfiguration(config) {\r\n        const { code, corpid, encrypted_corpsecret, agentid, touser, description,\r\n            callback_token, encrypted_encoding_aes_key, callback_enabled } = config;\r\n\r\n        const result = await this.db.prepare(`\r\n            INSERT OR REPLACE INTO configurations (\r\n                code, corpid, encrypted_corpsecret, agentid, touser, description,\r\n                callback_token, encrypted_encoding_aes_key, callback_enabled\r\n            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n        `).bind(\r\n            code, corpid, encrypted_corpsecret, agentid, touser, description,\r\n            callback_token, encrypted_encoding_aes_key, callback_enabled || 0\r\n        ).run();\r\n\r\n        return { id: result.meta.last_row_id, code };\r\n    }\r\n\r\n    // \u6839\u636E code \u83B7\u53D6\u914D\u7F6E\r\n    async getConfigurationByCode(code) {\r\n        const result = await this.db.prepare(\r\n            'SELECT * FROM configurations WHERE code = ?'\r\n        ).bind(code).first();\r\n\r\n        return result;\r\n    }\r\n\r\n    // \u66F4\u65B0\u914D\u7F6E\r\n    async updateConfiguration(config) {\r\n        const { code, corpid, encrypted_corpsecret, agentid, touser, description,\r\n            callback_token, encrypted_encoding_aes_key, callback_enabled } = config;\r\n\r\n        await this.db.prepare(`\r\n            UPDATE configurations \r\n            SET corpid = ?, encrypted_corpsecret = ?, agentid = ?, touser = ?, description = ?,\r\n                callback_token = ?, encrypted_encoding_aes_key = ?, callback_enabled = ?\r\n            WHERE code = ?\r\n        `).bind(\r\n            corpid, encrypted_corpsecret, agentid, touser, description,\r\n            callback_token, encrypted_encoding_aes_key, callback_enabled,\r\n            code\r\n        ).run();\r\n\r\n        return { code };\r\n    }\r\n\r\n    // \u4FDD\u5B58\u63A5\u6536\u5230\u7684\u6D88\u606F\r\n    async saveReceivedMessage(messageData) {\r\n        const createTime = messageData.createTime || Math.floor(Date.now() / 1000);\r\n        const beijingTime = createTime * 1000 + 8 * 60 * 60 * 1000;\r\n        const date = new Date(beijingTime);\r\n        const beijingTimestamp = Math.floor(beijingTime / 1000);\r\n        const dateStr = date.toISOString().replace('Z', '').replace('T', ' ');\r\n        const isoTimeStr = date.toISOString().split('.')[0] + 'Z';\r\n        const isReply = messageData.quoteMsg ? 1 : 0;\r\n\r\n        await this.db.prepare(`\r\n            INSERT OR REPLACE INTO received_messages (\r\n                message_id, config_code, from_user, from_user_name, to_user, agent_id,\r\n                msg_type, content, media_id, pic_url, file_name, file_size,\r\n                quote_msg_id, quote_content, quote_from_user, quote_from_user_name, quote_msg_type,\r\n                event_type, event_key,\r\n                created_at, created_time, created_date, is_reply, is_read,\r\n                format, recognition, thumb_media_id, location_x, location_y, scale, label,\r\n                title, description, url, app_type\r\n            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n        `).bind(\r\n            messageData.message_id || `msg_${Date.now()}`,\r\n            messageData.config_code || '',\r\n            messageData.from_user || 'unknown_user',\r\n            messageData.from_user_name || messageData.from_user || 'unknown',\r\n            messageData.to_user || '',\r\n            messageData.agent_id || '',\r\n            messageData.msg_type || 'text',\r\n            messageData.content || null,\r\n            messageData.media_id || null,\r\n            messageData.pic_url || null,\r\n            messageData.file_name || null,\r\n            messageData.file_size || null,\r\n            messageData.quoteMsg?.msgId || messageData.quote_msg_id || null,\r\n            messageData.quoteMsg?.content || messageData.quote_content || null,\r\n            messageData.quoteMsg?.fromUser || messageData.quote_from_user || null,\r\n            messageData.quoteMsg?.fromUserName || messageData.quote_from_user_name || null,\r\n            messageData.quoteMsg?.msgType || messageData.quote_msg_type || null,\r\n            messageData.event_type || null,\r\n            messageData.event_key || null,\r\n            beijingTimestamp,\r\n            isoTimeStr,\r\n            dateStr,\r\n            isReply,\r\n            0,\r\n            messageData.format || null,\r\n            messageData.recognition || null,\r\n            messageData.thumb_media_id || null,\r\n            messageData.location_x || messageData.location_X || null,\r\n            messageData.location_y || messageData.location_Y || null,\r\n            messageData.scale || null,\r\n            messageData.label || null,\r\n            messageData.title || null,\r\n            messageData.description || null,\r\n            messageData.url || null,\r\n            messageData.app_type || null\r\n        ).run();\r\n\r\n        console.log('\u2705 \u6D88\u606F\u4FDD\u5B58\u6210\u529F:', messageData.message_id);\r\n    }\r\n\r\n    // \u67E5\u8BE2\u6D88\u606F\r\n    async getReceivedMessages(filters = {}) {\r\n        let sql = `\r\n            SELECT \r\n                m.*,\r\n                (SELECT COUNT(*) FROM received_messages WHERE quote_msg_id = m.message_id) as reply_count\r\n            FROM received_messages m\r\n            WHERE 1=1\r\n        `;\r\n        const params = [];\r\n\r\n        if (filters.config_code) {\r\n            sql += ' AND m.config_code = ?';\r\n            params.push(filters.config_code);\r\n        }\r\n\r\n        if (filters.fromUser) {\r\n            sql += ' AND m.from_user = ?';\r\n            params.push(filters.fromUser);\r\n        }\r\n\r\n        if (filters.msgType) {\r\n            sql += ' AND m.msg_type = ?';\r\n            params.push(filters.msgType);\r\n        }\r\n\r\n        if (filters.startDate) {\r\n            sql += ' AND (m.created_date >= ? OR m.created_date LIKE ?)';\r\n            params.push(filters.startDate, filters.startDate + ' %');\r\n        }\r\n\r\n        if (filters.endDate) {\r\n            const endDatePlusOne = new Date(filters.endDate);\r\n            endDatePlusOne.setDate(endDatePlusOne.getDate() + 1);\r\n            const endDateNextDay = endDatePlusOne.toISOString().split('T')[0];\r\n            sql += ' AND (m.created_date < ? OR m.created_date LIKE ?)';\r\n            params.push(endDateNextDay, filters.endDate + ' %');\r\n        }\r\n\r\n        if (filters.keyword) {\r\n            sql += ` AND (m.content LIKE ? OR m.quote_content LIKE ? OR m.from_user_name LIKE ?)`;\r\n            const keyword = `%${filters.keyword}%`;\r\n            params.push(keyword, keyword, keyword);\r\n        }\r\n\r\n        const orderBy = filters.sortField || filters.orderBy || 'created_at';\r\n        const orderDir = filters.sortOrder || filters.orderDir || 'DESC';\r\n        sql += ` ORDER BY m.${orderBy} ${orderDir}`;\r\n\r\n        const limit = filters.limit || 100;\r\n        const offset = filters.offset || 0;\r\n        sql += ' LIMIT ? OFFSET ?';\r\n        params.push(limit, offset);\r\n\r\n        const stmt = this.db.prepare(sql).bind(...params);\r\n        const result = await stmt.all();\r\n\r\n        return result.results || [];\r\n    }\r\n\r\n    // \u83B7\u53D6\u6D88\u606F\u603B\u6570\r\n    async getReceivedMessagesCount(filters = {}) {\r\n        let sql = 'SELECT COUNT(*) as total FROM received_messages m WHERE 1=1';\r\n        const params = [];\r\n\r\n        if (filters.config_code) {\r\n            sql += ' AND m.config_code = ?';\r\n            params.push(filters.config_code);\r\n        }\r\n\r\n        if (filters.fromUser) {\r\n            sql += ' AND m.from_user = ?';\r\n            params.push(filters.fromUser);\r\n        }\r\n\r\n        if (filters.msgType) {\r\n            sql += ' AND m.msg_type = ?';\r\n            params.push(filters.msgType);\r\n        }\r\n\r\n        if (filters.startDate) {\r\n            sql += ' AND (m.created_date >= ? OR m.created_date LIKE ?)';\r\n            params.push(filters.startDate, filters.startDate + ' %');\r\n        }\r\n\r\n        if (filters.endDate) {\r\n            const endDatePlusOne = new Date(filters.endDate);\r\n            endDatePlusOne.setDate(endDatePlusOne.getDate() + 1);\r\n            const endDateNextDay = endDatePlusOne.toISOString().split('T')[0];\r\n            sql += ' AND (m.created_date < ? OR m.created_date LIKE ?)';\r\n            params.push(endDateNextDay, filters.endDate + ' %');\r\n        }\r\n\r\n        if (filters.keyword) {\r\n            sql += ` AND (m.content LIKE ? OR m.quote_content LIKE ? OR m.from_user_name LIKE ?)`;\r\n            const keyword = `%${filters.keyword}%`;\r\n            params.push(keyword, keyword, keyword);\r\n        }\r\n\r\n        const result = await this.db.prepare(sql).bind(...params).first();\r\n        return result?.total || 0;\r\n    }\r\n\r\n    // \u83B7\u53D6\u6D88\u606F\u7EDF\u8BA1\r\n    async getMessageStats(configCode, filters = {}) {\r\n        let sql = `\r\n            SELECT \r\n                COUNT(*) as total,\r\n                COUNT(CASE WHEN msg_type = 'text' THEN 1 END) as text_count,\r\n                COUNT(CASE WHEN msg_type = 'image' THEN 1 END) as image_count,\r\n                COUNT(CASE WHEN msg_type = 'file' THEN 1 END) as file_count,\r\n                COUNT(CASE WHEN is_reply = 1 THEN 1 END) as reply_count,\r\n                COUNT(DISTINCT from_user) as user_count,\r\n                COUNT(CASE WHEN is_read = 0 THEN 1 END) as unread_count,\r\n                COUNT(CASE WHEN is_read = 1 THEN 1 END) as read_count,\r\n                COUNT(CASE WHEN created_date = date('now') THEN 1 END) as today_count\r\n            FROM received_messages\r\n            WHERE config_code = ?\r\n        `;\r\n        const params = [configCode];\r\n\r\n        if (filters.startDate) {\r\n            sql += ' AND (created_date >= ? OR created_date LIKE ?)';\r\n            params.push(filters.startDate, filters.startDate + ' %');\r\n        }\r\n\r\n        if (filters.endDate) {\r\n            const endDatePlusOne = new Date(filters.endDate);\r\n            endDatePlusOne.setDate(endDatePlusOne.getDate() + 1);\r\n            const endDateNextDay = endDatePlusOne.toISOString().split('T')[0];\r\n            sql += ' AND (created_date < ? OR created_date LIKE ?)';\r\n            params.push(endDateNextDay, filters.endDate + ' %');\r\n        }\r\n\r\n        const result = await this.db.prepare(sql).bind(...params).first();\r\n        return result || {\r\n            total: 0,\r\n            text_count: 0,\r\n            image_count: 0,\r\n            file_count: 0,\r\n            reply_count: 0,\r\n            user_count: 0,\r\n            unread_count: 0,\r\n            read_count: 0,\r\n            today_count: 0\r\n        };\r\n    }\r\n\r\n    // \u6807\u8BB0\u6D88\u606F\u4E3A\u5DF2\u8BFB\r\n    async markMessageAsRead(messageId) {\r\n        const result = await this.db.prepare(\r\n            'UPDATE received_messages SET is_read = 1 WHERE message_id = ?'\r\n        ).bind(messageId).run();\r\n\r\n        return result.meta.changes > 0;\r\n    }\r\n}\r\n", "/**\r\n * Cloudflare Workers \u52A0\u5BC6\u89E3\u5BC6\u6A21\u5757\r\n * \u4F7F\u7528 Web Crypto API\r\n */\r\n\r\n// \u5C06\u5B57\u7B26\u4E32\u8F6C\u6362\u4E3A ArrayBuffer\r\nfunction str2ab(str) {\r\n    const encoder = new TextEncoder();\r\n    return encoder.encode(str);\r\n}\r\n\r\n// \u5C06 ArrayBuffer \u8F6C\u6362\u4E3A\u5B57\u7B26\u4E32\r\nfunction ab2str(buffer) {\r\n    const decoder = new TextDecoder();\r\n    return decoder.decode(buffer);\r\n}\r\n\r\n// \u5C06 ArrayBuffer \u8F6C\u6362\u4E3A Base64\r\nfunction ab2base64(buffer) {\r\n    const bytes = new Uint8Array(buffer);\r\n    let binary = '';\r\n    for (let i = 0; i < bytes.byteLength; i++) {\r\n        binary += String.fromCharCode(bytes[i]);\r\n    }\r\n    return btoa(binary);\r\n}\r\n\r\n// \u5C06 Base64 \u8F6C\u6362\u4E3A ArrayBuffer\r\nfunction base642ab(base64) {\r\n    const binary = atob(base64);\r\n    const bytes = new Uint8Array(binary.length);\r\n    for (let i = 0; i < binary.length; i++) {\r\n        bytes[i] = binary.charCodeAt(i);\r\n    }\r\n    return bytes.buffer;\r\n}\r\n\r\n// \u4ECE\u5BC6\u94A5\u5B57\u7B26\u4E32\u6D3E\u751F\u52A0\u5BC6\u5BC6\u94A5\r\nasync function deriveKey(password) {\r\n    const keyMaterial = await crypto.subtle.importKey(\r\n        'raw',\r\n        str2ab(password),\r\n        { name: 'PBKDF2' },\r\n        false,\r\n        ['deriveBits', 'deriveKey']\r\n    );\r\n    \r\n    return crypto.subtle.deriveKey(\r\n        {\r\n            name: 'PBKDF2',\r\n            salt: str2ab('wechat-notifier-salt'),\r\n            iterations: 100000,\r\n            hash: 'SHA-256'\r\n        },\r\n        keyMaterial,\r\n        { name: 'AES-GCM', length: 256 },\r\n        false,\r\n        ['encrypt', 'decrypt']\r\n    );\r\n}\r\n\r\n// \u52A0\u5BC6\u51FD\u6570\r\nexport async function encrypt(text, password) {\r\n    const key = await deriveKey(password);\r\n    const iv = crypto.getRandomValues(new Uint8Array(12));\r\n    \r\n    const encrypted = await crypto.subtle.encrypt(\r\n        {\r\n            name: 'AES-GCM',\r\n            iv: iv\r\n        },\r\n        key,\r\n        str2ab(text)\r\n    );\r\n    \r\n    // \u5C06 IV \u548C\u52A0\u5BC6\u6570\u636E\u7EC4\u5408\r\n    const combined = new Uint8Array(iv.length + encrypted.byteLength);\r\n    combined.set(iv);\r\n    combined.set(new Uint8Array(encrypted), iv.length);\r\n    \r\n    return ab2base64(combined.buffer);\r\n}\r\n\r\n// \u89E3\u5BC6\u51FD\u6570\r\nexport async function decrypt(encryptedText, password) {\r\n    const key = await deriveKey(password);\r\n    const combined = new Uint8Array(base642ab(encryptedText));\r\n    \r\n    // \u5206\u79BB IV \u548C\u52A0\u5BC6\u6570\u636E\r\n    const iv = combined.slice(0, 12);\r\n    const encrypted = combined.slice(12);\r\n    \r\n    const decrypted = await crypto.subtle.decrypt(\r\n        {\r\n            name: 'AES-GCM',\r\n            iv: iv\r\n        },\r\n        key,\r\n        encrypted\r\n    );\r\n    \r\n    return ab2str(decrypted);\r\n}\r\n", "/**\r\n * Cloudflare \u7248\u672C\u7684\u901A\u77E5\u670D\u52A1\r\n * \u9002\u914D D1 \u6570\u636E\u5E93\u548C Workers \u73AF\u5883\r\n */\r\nimport { DatabaseCF } from '../core/database-cf.js';\r\nimport { encrypt, decrypt } from '../core/crypto-cf.js';\r\n\r\n// \u7F13\u5B58 access_token\uFF08\u4F7F\u7528 KV \u6216\u5185\u5B58\uFF09\r\nasync function getAccessToken(db, cache, encryptionKey, corpid, encryptedCorpsecret) {\r\n    const cacheKey = `access_token_${corpid}`;\r\n    \r\n    // \u5C1D\u8BD5\u4ECE KV \u7F13\u5B58\u83B7\u53D6\r\n    if (cache) {\r\n        const cached = await cache.get(cacheKey, 'json');\r\n        if (cached && cached.expires_at > Date.now()) {\r\n            return cached.token;\r\n        }\r\n    }\r\n    \r\n    // \u89E3\u5BC6 corpsecret\r\n    const corpsecret = await decrypt(encryptedCorpsecret, encryptionKey);\r\n    \r\n    // \u4ECE\u4F01\u4E1A\u5FAE\u4FE1\u83B7\u53D6\u65B0 token\r\n    const response = await fetch(\r\n        `https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=${corpid}&corpsecret=${corpsecret}`\r\n    );\r\n    const data = await response.json();\r\n    \r\n    if (data.errcode !== 0) {\r\n        throw new Error(`\u83B7\u53D6access_token\u5931\u8D25: ${data.errmsg}`);\r\n    }\r\n    \r\n    // \u7F13\u5B58\u5230 KV\uFF08\u63D0\u524D5\u5206\u949F\u8FC7\u671F\uFF09\r\n    if (cache) {\r\n        await cache.put(cacheKey, JSON.stringify({\r\n            token: data.access_token,\r\n            expires_at: Date.now() + (data.expires_in - 300) * 1000\r\n        }), {\r\n            expirationTtl: data.expires_in - 300\r\n        });\r\n    }\r\n    \r\n    return data.access_token;\r\n}\r\n\r\n// \u9A8C\u8BC1\u4F01\u4E1A\u5FAE\u4FE1\u51ED\u8BC1\r\nexport async function validateCredentials(corpid, corpsecret) {\r\n    const response = await fetch(\r\n        `https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=${corpid}&corpsecret=${corpsecret}`\r\n    );\r\n    const data = await response.json();\r\n    \r\n    if (data.errcode !== 0) {\r\n        throw new Error(`\u51ED\u8BC1\u9A8C\u8BC1\u5931\u8D25: ${data.errmsg}`);\r\n    }\r\n    \r\n    // \u83B7\u53D6\u6210\u5458\u5217\u8868\r\n    const usersResponse = await fetch(\r\n        `https://qyapi.weixin.qq.com/cgi-bin/user/list?access_token=${data.access_token}&department_id=1`\r\n    );\r\n    const usersData = await usersResponse.json();\r\n    \r\n    if (usersData.errcode !== 0) {\r\n        throw new Error(`\u83B7\u53D6\u6210\u5458\u5217\u8868\u5931\u8D25: ${usersData.errmsg}`);\r\n    }\r\n    \r\n    return usersData.userlist || [];\r\n}\r\n\r\n// \u521B\u5EFA\u914D\u7F6E\r\nexport async function createConfiguration(db, encryptionKey, config) {\r\n    const dbInstance = new DatabaseCF(db);\r\n    const { corpid, corpsecret, agentid, touser, description } = config;\r\n    \r\n    // \u751F\u6210\u552F\u4E00 code\r\n    const code = generateCode();\r\n    \r\n    // \u52A0\u5BC6\u654F\u611F\u4FE1\u606F\r\n    const encrypted_corpsecret = await encrypt(corpsecret, encryptionKey);\r\n    \r\n    await dbInstance.saveConfiguration({\r\n        code,\r\n        corpid,\r\n        encrypted_corpsecret,\r\n        agentid,\r\n        touser,\r\n        description: description || '',\r\n        callback_enabled: 0\r\n    });\r\n    \r\n    return { code, message: '\u914D\u7F6E\u521B\u5EFA\u6210\u529F' };\r\n}\r\n\r\n// \u83B7\u53D6\u914D\u7F6E\r\nexport async function getConfiguration(db, encryptionKey, code) {\r\n    const dbInstance = new DatabaseCF(db);\r\n    const config = await dbInstance.getConfigurationByCode(code);\r\n    \r\n    if (!config) {\r\n        return null;\r\n    }\r\n    \r\n    // \u89E3\u5BC6\u654F\u611F\u4FE1\u606F\uFF08\u4EC5\u8FD4\u56DE\u90E8\u5206\u4FE1\u606F\uFF09\r\n    return {\r\n        code: config.code,\r\n        corpid: config.corpid,\r\n        agentid: config.agentid,\r\n        touser: config.touser,\r\n        description: config.description,\r\n        callback_enabled: config.callback_enabled,\r\n        created_at: config.created_at\r\n    };\r\n}\r\n\r\n// \u66F4\u65B0\u914D\u7F6E\r\nexport async function updateConfiguration(db, encryptionKey, code, updates) {\r\n    const dbInstance = new DatabaseCF(db);\r\n    const existingConfig = await dbInstance.getConfigurationByCode(code);\r\n    \r\n    if (!existingConfig) {\r\n        throw new Error('\u914D\u7F6E\u4E0D\u5B58\u5728');\r\n    }\r\n    \r\n    const updatedConfig = {\r\n        code,\r\n        corpid: updates.corpid || existingConfig.corpid,\r\n        encrypted_corpsecret: updates.corpsecret \r\n            ? await encrypt(updates.corpsecret, encryptionKey)\r\n            : existingConfig.encrypted_corpsecret,\r\n        agentid: updates.agentid || existingConfig.agentid,\r\n        touser: updates.touser || existingConfig.touser,\r\n        description: updates.description !== undefined ? updates.description : existingConfig.description,\r\n        callback_token: updates.callback_token || existingConfig.callback_token,\r\n        encrypted_encoding_aes_key: updates.encoding_aes_key\r\n            ? await encrypt(updates.encoding_aes_key, encryptionKey)\r\n            : existingConfig.encrypted_encoding_aes_key,\r\n        callback_enabled: updates.callback_enabled !== undefined ? updates.callback_enabled : existingConfig.callback_enabled\r\n    };\r\n    \r\n    await dbInstance.updateConfiguration(updatedConfig);\r\n    return { code, message: '\u914D\u7F6E\u66F4\u65B0\u6210\u529F' };\r\n}\r\n\r\n// \u53D1\u9001\u901A\u77E5\r\nexport async function sendNotification(db, cache, encryptionKey, code, title, content) {\r\n    const dbInstance = new DatabaseCF(db);\r\n    const config = await dbInstance.getConfigurationByCode(code);\r\n    \r\n    if (!config) {\r\n        throw new Error('\u672A\u627E\u5230\u914D\u7F6E');\r\n    }\r\n    \r\n    const accessToken = await getAccessToken(db, cache, encryptionKey, config.corpid, config.encrypted_corpsecret);\r\n    \r\n    const message = {\r\n        touser: config.touser,\r\n        msgtype: 'text',\r\n        agentid: config.agentid,\r\n        text: {\r\n            content: title ? `${title}\\n${content}` : content\r\n        }\r\n    };\r\n    \r\n    const response = await fetch(\r\n        `https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=${accessToken}`,\r\n        {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(message)\r\n        }\r\n    );\r\n    \r\n    const result = await response.json();\r\n    \r\n    if (result.errcode !== 0) {\r\n        throw new Error(`\u53D1\u9001\u6D88\u606F\u5931\u8D25: ${result.errmsg}`);\r\n    }\r\n    \r\n    return result;\r\n}\r\n\r\n// \u53D1\u9001\u589E\u5F3A\u6D88\u606F\r\nexport async function sendEnhancedNotification(db, cache, encryptionKey, code, messageData) {\r\n    const dbInstance = new DatabaseCF(db);\r\n    const config = await dbInstance.getConfigurationByCode(code);\r\n    \r\n    if (!config) {\r\n        throw new Error('\u672A\u627E\u5230\u914D\u7F6E');\r\n    }\r\n    \r\n    const accessToken = await getAccessToken(db, cache, encryptionKey, config.corpid, config.encrypted_corpsecret);\r\n    \r\n    let message = {\r\n        touser: config.touser,\r\n        agentid: config.agentid,\r\n        msgtype: messageData.type\r\n    };\r\n    \r\n    // \u6839\u636E\u6D88\u606F\u7C7B\u578B\u6784\u5EFA\u6D88\u606F\u4F53\r\n    switch (messageData.type) {\r\n        case 'text':\r\n            message.text = { content: messageData.content };\r\n            break;\r\n        case 'textcard':\r\n            message.textcard = {\r\n                title: messageData.title,\r\n                description: messageData.description,\r\n                url: messageData.url,\r\n                btntxt: messageData.btntxt || '\u8BE6\u60C5'\r\n            };\r\n            break;\r\n        case 'markdown':\r\n            message.markdown = { content: messageData.content };\r\n            break;\r\n        case 'news':\r\n            message.news = { articles: messageData.articles };\r\n            break;\r\n        default:\r\n            throw new Error(`\u4E0D\u652F\u6301\u7684\u6D88\u606F\u7C7B\u578B: ${messageData.type}`);\r\n    }\r\n    \r\n    const response = await fetch(\r\n        `https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=${accessToken}`,\r\n        {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(message)\r\n        }\r\n    );\r\n    \r\n    const result = await response.json();\r\n    \r\n    if (result.errcode !== 0) {\r\n        throw new Error(`\u53D1\u9001\u6D88\u606F\u5931\u8D25: ${result.errmsg}`);\r\n    }\r\n    \r\n    return result;\r\n}\r\n\r\n// \u67E5\u8BE2\u6D88\u606F\r\nexport async function queryMessages(db, code, queryParams) {\r\n    const dbInstance = new DatabaseCF(db);\r\n    \r\n    const page = parseInt(queryParams.page) || 1;\r\n    const limit = parseInt(queryParams.limit) || parseInt(queryParams.pageSize) || 20;\r\n    const offset = (page - 1) * limit;\r\n    \r\n    const filters = {\r\n        config_code: code,\r\n        limit,\r\n        offset,\r\n        sortField: queryParams.sortBy || 'created_at',\r\n        sortOrder: queryParams.sortOrder || 'desc',\r\n        startDate: queryParams.startDate,\r\n        endDate: queryParams.endDate,\r\n        msgType: queryParams.msgType,\r\n        keyword: queryParams.keyword,\r\n        fromUser: queryParams.fromUser\r\n    };\r\n    \r\n    const messages = await dbInstance.getReceivedMessages(filters);\r\n    const total = await dbInstance.getReceivedMessagesCount(filters);\r\n    \r\n    return {\r\n        messages,\r\n        total,\r\n        page,\r\n        limit,\r\n        totalPages: Math.ceil(total / limit)\r\n    };\r\n}\r\n\r\n// \u5904\u7406\u56DE\u8C03\u9A8C\u8BC1\r\nexport async function handleCallbackVerification(db, encryptionKey, code, msg_signature, timestamp, nonce, echostr) {\r\n    const dbInstance = new DatabaseCF(db);\r\n    const config = await dbInstance.getConfigurationByCode(code);\r\n    \r\n    if (!config || !config.callback_enabled) {\r\n        return { success: false, error: '\u56DE\u8C03\u672A\u542F\u7528' };\r\n    }\r\n    \r\n    // \u8FD9\u91CC\u9700\u8981\u5B9E\u73B0\u4F01\u4E1A\u5FAE\u4FE1\u7684\u7B7E\u540D\u9A8C\u8BC1\u903B\u8F91\r\n    // \u7531\u4E8E wxcrypt \u5E93\u53EF\u80FD\u4E0D\u517C\u5BB9 Workers\uFF0C\u9700\u8981\u4F7F\u7528 Web Crypto API \u91CD\u65B0\u5B9E\u73B0\r\n    \r\n    return { success: true, data: echostr };\r\n}\r\n\r\n// \u5904\u7406\u56DE\u8C03\u6D88\u606F\r\nexport async function handleCallbackMessage(db, encryptionKey, code, encryptedData, msg_signature, timestamp, nonce) {\r\n    const dbInstance = new DatabaseCF(db);\r\n    const config = await dbInstance.getConfigurationByCode(code);\r\n    \r\n    if (!config || !config.callback_enabled) {\r\n        return { success: false, error: '\u56DE\u8C03\u672A\u542F\u7528' };\r\n    }\r\n    \r\n    // \u89E3\u5BC6\u6D88\u606F\u5E76\u4FDD\u5B58\u5230\u6570\u636E\u5E93\r\n    // \u8FD9\u91CC\u9700\u8981\u5B9E\u73B0\u6D88\u606F\u89E3\u5BC6\u548C\u89E3\u6790\u903B\u8F91\r\n    \r\n    return { success: true, message: '\u6D88\u606F\u5904\u7406\u6210\u529F' };\r\n}\r\n\r\n// \u751F\u6210\u552F\u4E00 code\r\nfunction generateCode() {\r\n    return 'cf_' + Math.random().toString(36).substring(2, 15) + \r\n           Math.random().toString(36).substring(2, 15);\r\n}\r\n", "/**\r\n * POST /api/notify/:code/enhanced - \u53D1\u9001\u589E\u5F3A\u6D88\u606F\r\n */\r\nimport { sendEnhancedNotification } from '../../../../src/services/notifier-cf.js';\r\n\r\nexport async function onRequestPost(context) {\r\n    const { request, env, params } = context;\r\n    const { code } = params;\r\n    \r\n    try {\r\n        const messageData = await request.json();\r\n        \r\n        if (!messageData.type) {\r\n            return new Response(JSON.stringify({\r\n                error: '\u7F3A\u5C11\u6D88\u606F\u7C7B\u578B(type)\u53C2\u6570'\r\n            }), {\r\n                status: 400,\r\n                headers: { 'Content-Type': 'application/json' }\r\n            });\r\n        }\r\n        \r\n        console.log('\uD83D\uDCE5 \u6536\u5230\u589E\u5F3A\u6D88\u606F\u8BF7\u6C42:', {\r\n            code: code.substring(0, 8) + '...',\r\n            type: messageData.type\r\n        });\r\n        \r\n        const result = await sendEnhancedNotification(env.DB, env.CACHE, env.ENCRYPTION_KEY, code, messageData);\r\n        \r\n        return new Response(JSON.stringify({\r\n            message: '\u53D1\u9001\u6210\u529F',\r\n            response: result,\r\n            messageType: messageData.type\r\n        }), {\r\n            status: 200,\r\n            headers: { 'Content-Type': 'application/json' }\r\n        });\r\n    } catch (error) {\r\n        console.error('\u53D1\u9001\u589E\u5F3A\u6D88\u606F\u5931\u8D25:', error);\r\n        const status = error.message?.includes('\u672A\u627E\u5230\u914D\u7F6E') ? 404 : 500;\r\n        return new Response(JSON.stringify({\r\n            error: error.message || '\u6D88\u606F\u53D1\u9001\u5931\u8D25'\r\n        }), {\r\n            status,\r\n            headers: { 'Content-Type': 'application/json' }\r\n        });\r\n    }\r\n}\r\n", "/**\r\n * GET /api/callback/:code - \u4F01\u4E1A\u5FAE\u4FE1\u56DE\u8C03\u9A8C\u8BC1\r\n * POST /api/callback/:code - \u4F01\u4E1A\u5FAE\u4FE1\u56DE\u8C03\u6D88\u606F\u63A5\u6536\r\n */\r\nimport { handleCallbackVerification, handleCallbackMessage } from '../../../src/services/notifier-cf.js';\r\n\r\nexport async function onRequestGet(context) {\r\n    const { request, env, params } = context;\r\n    const { code } = params;\r\n    const url = new URL(request.url);\r\n    \r\n    const msg_signature = url.searchParams.get('msg_signature');\r\n    const timestamp = url.searchParams.get('timestamp');\r\n    const nonce = url.searchParams.get('nonce');\r\n    const echostr = url.searchParams.get('echostr');\r\n    \r\n    if (!msg_signature || !timestamp || !nonce || !echostr) {\r\n        return new Response(JSON.stringify({\r\n            error: '\u7F3A\u5C11\u5FC5\u8981\u7684\u9A8C\u8BC1\u53C2\u6570'\r\n        }), {\r\n            status: 400,\r\n            headers: { 'Content-Type': 'application/json' }\r\n        });\r\n    }\r\n    \r\n    try {\r\n        const result = await handleCallbackVerification(env.DB, env.ENCRYPTION_KEY, code, msg_signature, timestamp, nonce, echostr);\r\n        \r\n        if (result.success) {\r\n            return new Response(result.data, {\r\n                status: 200,\r\n                headers: { 'Content-Type': 'text/plain' }\r\n            });\r\n        } else {\r\n            console.error('\u56DE\u8C03\u9A8C\u8BC1\u5931\u8D25:', result.error);\r\n            return new Response('failed', {\r\n                status: 400,\r\n                headers: { 'Content-Type': 'text/plain' }\r\n            });\r\n        }\r\n    } catch (error) {\r\n        console.error('\u56DE\u8C03\u9A8C\u8BC1\u5F02\u5E38:', error);\r\n        return new Response('failed', {\r\n            status: 500,\r\n            headers: { 'Content-Type': 'text/plain' }\r\n        });\r\n    }\r\n}\r\n\r\nexport async function onRequestPost(context) {\r\n    const { request, env, params } = context;\r\n    const { code } = params;\r\n    const url = new URL(request.url);\r\n    \r\n    const msg_signature = url.searchParams.get('msg_signature');\r\n    const timestamp = url.searchParams.get('timestamp');\r\n    const nonce = url.searchParams.get('nonce');\r\n    \r\n    if (!msg_signature || !timestamp || !nonce) {\r\n        return new Response(JSON.stringify({\r\n            error: '\u7F3A\u5C11\u5FC5\u8981\u7684\u9A8C\u8BC1\u53C2\u6570'\r\n        }), {\r\n            status: 400,\r\n            headers: { 'Content-Type': 'application/json' }\r\n        });\r\n    }\r\n    \r\n    try {\r\n        const encryptedData = await request.text();\r\n        \r\n        if (!encryptedData) {\r\n            return new Response(JSON.stringify({\r\n                error: '\u6D88\u606F\u6570\u636E\u4E3A\u7A7A'\r\n            }), {\r\n                status: 400,\r\n                headers: { 'Content-Type': 'application/json' }\r\n            });\r\n        }\r\n        \r\n        const result = await handleCallbackMessage(env.DB, env.ENCRYPTION_KEY, code, encryptedData, msg_signature, timestamp, nonce);\r\n        \r\n        if (result.success) {\r\n            console.log('\u56DE\u8C03\u6D88\u606F\u5904\u7406\u6210\u529F:', result.message);\r\n            return new Response('ok', {\r\n                status: 200,\r\n                headers: { 'Content-Type': 'text/plain' }\r\n            });\r\n        } else {\r\n            console.error('\u56DE\u8C03\u6D88\u606F\u5904\u7406\u5931\u8D25:', result.error);\r\n            return new Response('failed', {\r\n                status: 400,\r\n                headers: { 'Content-Type': 'text/plain' }\r\n            });\r\n        }\r\n    } catch (error) {\r\n        console.error('\u56DE\u8C03\u6D88\u606F\u5904\u7406\u5F02\u5E38:', error);\r\n        return new Response('failed', {\r\n            status: 500,\r\n            headers: { 'Content-Type': 'text/plain' }\r\n        });\r\n    }\r\n}\r\n", "/**\r\n * GET /api/configuration/:code - \u83B7\u53D6\u914D\u7F6E\r\n * PUT /api/configuration/:code - \u66F4\u65B0\u914D\u7F6E\r\n */\r\nimport { getConfiguration, updateConfiguration } from '../../../src/services/notifier-cf.js';\r\n\r\nexport async function onRequestGet(context) {\r\n    const { env, params } = context;\r\n    const { code } = params;\r\n    \r\n    try {\r\n        const config = await getConfiguration(env.DB, env.ENCRYPTION_KEY, code);\r\n        \r\n        if (!config) {\r\n            return new Response(JSON.stringify({\r\n                error: '\u672A\u627E\u5230\u914D\u7F6E'\r\n            }), {\r\n                status: 404,\r\n                headers: { 'Content-Type': 'application/json' }\r\n            });\r\n        }\r\n        \r\n        return new Response(JSON.stringify(config), {\r\n            status: 200,\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Cache-Control': 'no-cache, no-store, must-revalidate'\r\n            }\r\n        });\r\n    } catch (error) {\r\n        console.error('\u83B7\u53D6\u914D\u7F6E\u5931\u8D25:', error);\r\n        return new Response(JSON.stringify({\r\n            error: error.message || '\u83B7\u53D6\u914D\u7F6E\u5931\u8D25'\r\n        }), {\r\n            status: 500,\r\n            headers: { 'Content-Type': 'application/json' }\r\n        });\r\n    }\r\n}\r\n\r\nexport async function onRequestPut(context) {\r\n    const { request, env, params } = context;\r\n    const { code } = params;\r\n    \r\n    try {\r\n        const body = await request.json();\r\n        const result = await updateConfiguration(env.DB, env.ENCRYPTION_KEY, code, body);\r\n        \r\n        return new Response(JSON.stringify(result), {\r\n            status: 200,\r\n            headers: { 'Content-Type': 'application/json' }\r\n        });\r\n    } catch (error) {\r\n        console.error('\u66F4\u65B0\u914D\u7F6E\u5931\u8D25:', error);\r\n        return new Response(JSON.stringify({\r\n            error: error.message || '\u66F4\u65B0\u914D\u7F6E\u5931\u8D25'\r\n        }), {\r\n            status: 500,\r\n            headers: { 'Content-Type': 'application/json' }\r\n        });\r\n    }\r\n}\r\n", "/**\r\n * GET /api/messages/:code - \u67E5\u8BE2\u6D88\u606F\u5386\u53F2\r\n */\r\nimport { queryMessages } from '../../../src/services/notifier-cf.js';\r\n\r\nexport async function onRequestGet(context) {\r\n    const { request, env, params } = context;\r\n    const { code } = params;\r\n    \r\n    try {\r\n        const url = new URL(request.url);\r\n        const queryParams = Object.fromEntries(url.searchParams);\r\n        \r\n        console.log('\uD83D\uDCE5 \u6536\u5230\u6D88\u606F\u67E5\u8BE2\u8BF7\u6C42:', {\r\n            code: code.substring(0, 8) + '...',\r\n            params: queryParams\r\n        });\r\n        \r\n        const result = await queryMessages(env.DB, code, queryParams);\r\n        \r\n        return new Response(JSON.stringify({\r\n            success: true,\r\n            data: result,\r\n            timestamp: Date.now()\r\n        }), {\r\n            status: 200,\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Cache-Control': 'no-cache, no-store, must-revalidate'\r\n            }\r\n        });\r\n    } catch (error) {\r\n        console.error('\u67E5\u8BE2\u6D88\u606F\u5931\u8D25:', error);\r\n        return new Response(JSON.stringify({\r\n            success: false,\r\n            error: error.message || '\u6D88\u606F\u67E5\u8BE2\u5931\u8D25'\r\n        }), {\r\n            status: 400,\r\n            headers: { 'Content-Type': 'application/json' }\r\n        });\r\n    }\r\n}\r\n", "/**\r\n * POST /api/notify/:code - \u53D1\u9001\u901A\u77E5\r\n */\r\nimport { sendNotification } from '../../../src/services/notifier-cf.js';\r\n\r\nexport async function onRequestPost(context) {\r\n    const { request, env, params } = context;\r\n    const { code } = params;\r\n    \r\n    try {\r\n        const body = await request.json();\r\n        const { title, content } = body;\r\n        \r\n        if (!content) {\r\n            return new Response(JSON.stringify({\r\n                error: '\u6D88\u606F\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A'\r\n            }), {\r\n                status: 400,\r\n                headers: { 'Content-Type': 'application/json' }\r\n            });\r\n        }\r\n        \r\n        const result = await sendNotification(env.DB, env.CACHE, env.ENCRYPTION_KEY, code, title, content);\r\n        \r\n        return new Response(JSON.stringify({\r\n            message: '\u53D1\u9001\u6210\u529F',\r\n            response: result\r\n        }), {\r\n            status: 200,\r\n            headers: { 'Content-Type': 'application/json' }\r\n        });\r\n    } catch (error) {\r\n        console.error('\u53D1\u9001\u901A\u77E5\u5931\u8D25:', error);\r\n        const status = error.message?.includes('\u672A\u627E\u5230\u914D\u7F6E') ? 404 : 500;\r\n        return new Response(JSON.stringify({\r\n            error: error.message || '\u6D88\u606F\u53D1\u9001\u5931\u8D25'\r\n        }), {\r\n            status,\r\n            headers: { 'Content-Type': 'application/json' }\r\n        });\r\n    }\r\n}\r\n", "/**\r\n * POST /api/configure - \u4FDD\u5B58\u914D\u7F6E\r\n */\r\nimport { createConfiguration } from '../../src/services/notifier-cf.js';\r\n\r\nexport async function onRequestPost(context) {\r\n    const { request, env } = context;\r\n    \r\n    try {\r\n        const body = await request.json();\r\n        const { corpid, corpsecret, agentid, touser, description } = body;\r\n        \r\n        if (!corpid || !corpsecret || !agentid || !touser) {\r\n            return new Response(JSON.stringify({\r\n                error: '\u53C2\u6570\u4E0D\u5B8C\u6574\uFF0C\u9700\u8981\u63D0\u4F9B corpid, corpsecret, agentid, touser'\r\n            }), {\r\n                status: 400,\r\n                headers: { 'Content-Type': 'application/json' }\r\n            });\r\n        }\r\n        \r\n        const result = await createConfiguration(env.DB, env.ENCRYPTION_KEY, {\r\n            corpid,\r\n            corpsecret,\r\n            agentid,\r\n            touser,\r\n            description\r\n        });\r\n        \r\n        return new Response(JSON.stringify(result), {\r\n            status: 201,\r\n            headers: { 'Content-Type': 'application/json' }\r\n        });\r\n    } catch (error) {\r\n        console.error('\u4FDD\u5B58\u914D\u7F6E\u5931\u8D25:', error);\r\n        return new Response(JSON.stringify({\r\n            error: error.message || '\u914D\u7F6E\u4FDD\u5B58\u5931\u8D25'\r\n        }), {\r\n            status: 500,\r\n            headers: { 'Content-Type': 'application/json' }\r\n        });\r\n    }\r\n}\r\n", "/**\r\n * POST /api/validate - \u9A8C\u8BC1\u4F01\u4E1A\u5FAE\u4FE1\u51ED\u8BC1\r\n */\r\nimport { validateCredentials } from '../../src/services/notifier-cf.js';\r\n\r\nexport async function onRequestPost(context) {\r\n    const { request, env } = context;\r\n    \r\n    try {\r\n        const body = await request.json();\r\n        const { corpid, corpsecret } = body;\r\n        \r\n        if (!corpid || !corpsecret) {\r\n            return new Response(JSON.stringify({\r\n                error: '\u53C2\u6570\u4E0D\u5B8C\u6574\uFF0C\u9700\u8981\u63D0\u4F9B corpid \u548C corpsecret'\r\n            }), {\r\n                status: 400,\r\n                headers: { 'Content-Type': 'application/json' }\r\n            });\r\n        }\r\n        \r\n        const users = await validateCredentials(corpid, corpsecret);\r\n        \r\n        return new Response(JSON.stringify({ users }), {\r\n            status: 200,\r\n            headers: { 'Content-Type': 'application/json' }\r\n        });\r\n    } catch (error) {\r\n        console.error('\u9A8C\u8BC1\u51ED\u8BC1\u5931\u8D25:', error);\r\n        return new Response(JSON.stringify({\r\n            error: error.message || '\u51ED\u8BC1\u9A8C\u8BC1\u5931\u8D25'\r\n        }), {\r\n            status: 400,\r\n            headers: { 'Content-Type': 'application/json' }\r\n        });\r\n    }\r\n}\r\n", "/**\r\n * Cloudflare Pages Functions \u4E2D\u95F4\u4EF6\r\n * \u5904\u7406 CORS\u3001\u65E5\u5FD7\u8BB0\u5F55\u7B49\u5168\u5C40\u529F\u80FD\r\n */\r\n\r\nexport async function onRequest(context) {\r\n    const { request, next, env } = context;\r\n    \r\n    // \u6DFB\u52A0 CORS \u5934\r\n    const corsHeaders = {\r\n        'Access-Control-Allow-Origin': '*',\r\n        'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\r\n        'Access-Control-Allow-Headers': 'Content-Type, Authorization',\r\n    };\r\n\r\n    // \u5904\u7406 OPTIONS \u9884\u68C0\u8BF7\u6C42\r\n    if (request.method === 'OPTIONS') {\r\n        return new Response(null, {\r\n            status: 204,\r\n            headers: corsHeaders\r\n        });\r\n    }\r\n\r\n    // \u8BB0\u5F55\u8BF7\u6C42\u65E5\u5FD7\r\n    const start = Date.now();\r\n    const url = new URL(request.url);\r\n    console.log(`${request.method} ${url.pathname}`);\r\n\r\n    try {\r\n        // \u7EE7\u7EED\u5904\u7406\u8BF7\u6C42\r\n        const response = await next();\r\n        \r\n        // \u6DFB\u52A0 CORS \u5934\u5230\u54CD\u5E94\r\n        const newResponse = new Response(response.body, response);\r\n        Object.entries(corsHeaders).forEach(([key, value]) => {\r\n            newResponse.headers.set(key, value);\r\n        });\r\n        \r\n        // \u8BB0\u5F55\u54CD\u5E94\u65F6\u95F4\r\n        const duration = Date.now() - start;\r\n        console.log(`${request.method} ${url.pathname} - ${response.status} (${duration}ms)`);\r\n        \r\n        return newResponse;\r\n    } catch (error) {\r\n        console.error('\u8BF7\u6C42\u5904\u7406\u9519\u8BEF:', error);\r\n        return new Response(JSON.stringify({\r\n            error: '\u670D\u52A1\u5668\u5185\u90E8\u9519\u8BEF',\r\n            message: error.message,\r\n            timestamp: new Date().toISOString()\r\n        }), {\r\n            status: 500,\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                ...corsHeaders\r\n            }\r\n        });\r\n    }\r\n}\r\n", "import { onRequestPost as __api_notify__code__enhanced_js_onRequestPost } from \"D:\\\\15268\\\\Desktop\\\\qywx-push\\\\functions\\\\api\\\\notify\\\\[code]\\\\enhanced.js\"\nimport { onRequestGet as __api_callback__code__js_onRequestGet } from \"D:\\\\15268\\\\Desktop\\\\qywx-push\\\\functions\\\\api\\\\callback\\\\[code].js\"\nimport { onRequestPost as __api_callback__code__js_onRequestPost } from \"D:\\\\15268\\\\Desktop\\\\qywx-push\\\\functions\\\\api\\\\callback\\\\[code].js\"\nimport { onRequestGet as __api_configuration__code__js_onRequestGet } from \"D:\\\\15268\\\\Desktop\\\\qywx-push\\\\functions\\\\api\\\\configuration\\\\[code].js\"\nimport { onRequestPut as __api_configuration__code__js_onRequestPut } from \"D:\\\\15268\\\\Desktop\\\\qywx-push\\\\functions\\\\api\\\\configuration\\\\[code].js\"\nimport { onRequestGet as __api_messages__code__js_onRequestGet } from \"D:\\\\15268\\\\Desktop\\\\qywx-push\\\\functions\\\\api\\\\messages\\\\[code].js\"\nimport { onRequestPost as __api_notify__code__js_onRequestPost } from \"D:\\\\15268\\\\Desktop\\\\qywx-push\\\\functions\\\\api\\\\notify\\\\[code].js\"\nimport { onRequestPost as __api_configure_js_onRequestPost } from \"D:\\\\15268\\\\Desktop\\\\qywx-push\\\\functions\\\\api\\\\configure.js\"\nimport { onRequestPost as __api_validate_js_onRequestPost } from \"D:\\\\15268\\\\Desktop\\\\qywx-push\\\\functions\\\\api\\\\validate.js\"\nimport { onRequest as ___middleware_js_onRequest } from \"D:\\\\15268\\\\Desktop\\\\qywx-push\\\\functions\\\\_middleware.js\"\n\nexport const routes = [\n    {\n      routePath: \"/api/notify/:code/enhanced\",\n      mountPath: \"/api/notify/:code\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_notify__code__enhanced_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/callback/:code\",\n      mountPath: \"/api/callback\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_callback__code__js_onRequestGet],\n    },\n  {\n      routePath: \"/api/callback/:code\",\n      mountPath: \"/api/callback\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_callback__code__js_onRequestPost],\n    },\n  {\n      routePath: \"/api/configuration/:code\",\n      mountPath: \"/api/configuration\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_configuration__code__js_onRequestGet],\n    },\n  {\n      routePath: \"/api/configuration/:code\",\n      mountPath: \"/api/configuration\",\n      method: \"PUT\",\n      middlewares: [],\n      modules: [__api_configuration__code__js_onRequestPut],\n    },\n  {\n      routePath: \"/api/messages/:code\",\n      mountPath: \"/api/messages\",\n      method: \"GET\",\n      middlewares: [],\n      modules: [__api_messages__code__js_onRequestGet],\n    },\n  {\n      routePath: \"/api/notify/:code\",\n      mountPath: \"/api/notify\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_notify__code__js_onRequestPost],\n    },\n  {\n      routePath: \"/api/configure\",\n      mountPath: \"/api\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_configure_js_onRequestPost],\n    },\n  {\n      routePath: \"/api/validate\",\n      mountPath: \"/api\",\n      method: \"POST\",\n      middlewares: [],\n      modules: [__api_validate_js_onRequestPost],\n    },\n  {\n      routePath: \"/\",\n      mountPath: \"/\",\n      method: \"\",\n      middlewares: [___middleware_js_onRequest],\n      modules: [],\n    },\n  ]", "/**\n * Tokenizer results.\n */\ninterface LexToken {\n  type:\n    | \"OPEN\"\n    | \"CLOSE\"\n    | \"PATTERN\"\n    | \"NAME\"\n    | \"CHAR\"\n    | \"ESCAPED_CHAR\"\n    | \"MODIFIER\"\n    | \"END\";\n  index: number;\n  value: string;\n}\n\n/**\n * Tokenize input string.\n */\nfunction lexer(str: string): LexToken[] {\n  const tokens: LexToken[] = [];\n  let i = 0;\n\n  while (i < str.length) {\n    const char = str[i];\n\n    if (char === \"*\" || char === \"+\" || char === \"?\") {\n      tokens.push({ type: \"MODIFIER\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"\\\\\") {\n      tokens.push({ type: \"ESCAPED_CHAR\", index: i++, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"{\") {\n      tokens.push({ type: \"OPEN\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \"}\") {\n      tokens.push({ type: \"CLOSE\", index: i, value: str[i++] });\n      continue;\n    }\n\n    if (char === \":\") {\n      let name = \"\";\n      let j = i + 1;\n\n      while (j < str.length) {\n        const code = str.charCodeAt(j);\n\n        if (\n          // `0-9`\n          (code >= 48 && code <= 57) ||\n          // `A-Z`\n          (code >= 65 && code <= 90) ||\n          // `a-z`\n          (code >= 97 && code <= 122) ||\n          // `_`\n          code === 95\n        ) {\n          name += str[j++];\n          continue;\n        }\n\n        break;\n      }\n\n      if (!name) throw new TypeError(`Missing parameter name at ${i}`);\n\n      tokens.push({ type: \"NAME\", index: i, value: name });\n      i = j;\n      continue;\n    }\n\n    if (char === \"(\") {\n      let count = 1;\n      let pattern = \"\";\n      let j = i + 1;\n\n      if (str[j] === \"?\") {\n        throw new TypeError(`Pattern cannot start with \"?\" at ${j}`);\n      }\n\n      while (j < str.length) {\n        if (str[j] === \"\\\\\") {\n          pattern += str[j++] + str[j++];\n          continue;\n        }\n\n        if (str[j] === \")\") {\n          count--;\n          if (count === 0) {\n            j++;\n            break;\n          }\n        } else if (str[j] === \"(\") {\n          count++;\n          if (str[j + 1] !== \"?\") {\n            throw new TypeError(`Capturing groups are not allowed at ${j}`);\n          }\n        }\n\n        pattern += str[j++];\n      }\n\n      if (count) throw new TypeError(`Unbalanced pattern at ${i}`);\n      if (!pattern) throw new TypeError(`Missing pattern at ${i}`);\n\n      tokens.push({ type: \"PATTERN\", index: i, value: pattern });\n      i = j;\n      continue;\n    }\n\n    tokens.push({ type: \"CHAR\", index: i, value: str[i++] });\n  }\n\n  tokens.push({ type: \"END\", index: i, value: \"\" });\n\n  return tokens;\n}\n\nexport interface ParseOptions {\n  /**\n   * Set the default delimiter for repeat parameters. (default: `'/'`)\n   */\n  delimiter?: string;\n  /**\n   * List of characters to automatically consider prefixes when parsing.\n   */\n  prefixes?: string;\n}\n\n/**\n * Parse a string for the raw tokens.\n */\nexport function parse(str: string, options: ParseOptions = {}): Token[] {\n  const tokens = lexer(str);\n  const { prefixes = \"./\", delimiter = \"/#?\" } = options;\n  const result: Token[] = [];\n  let key = 0;\n  let i = 0;\n  let path = \"\";\n\n  const tryConsume = (type: LexToken[\"type\"]): string | undefined => {\n    if (i < tokens.length && tokens[i].type === type) return tokens[i++].value;\n  };\n\n  const mustConsume = (type: LexToken[\"type\"]): string => {\n    const value = tryConsume(type);\n    if (value !== undefined) return value;\n    const { type: nextType, index } = tokens[i];\n    throw new TypeError(`Unexpected ${nextType} at ${index}, expected ${type}`);\n  };\n\n  const consumeText = (): string => {\n    let result = \"\";\n    let value: string | undefined;\n    while ((value = tryConsume(\"CHAR\") || tryConsume(\"ESCAPED_CHAR\"))) {\n      result += value;\n    }\n    return result;\n  };\n\n  const isSafe = (value: string): boolean => {\n    for (const char of delimiter) if (value.indexOf(char) > -1) return true;\n    return false;\n  };\n\n  const safePattern = (prefix: string) => {\n    const prev = result[result.length - 1];\n    const prevText = prefix || (prev && typeof prev === \"string\" ? prev : \"\");\n\n    if (prev && !prevText) {\n      throw new TypeError(\n        `Must have text between two parameters, missing text after \"${(prev as Key).name}\"`,\n      );\n    }\n\n    if (!prevText || isSafe(prevText)) return `[^${escapeString(delimiter)}]+?`;\n    return `(?:(?!${escapeString(prevText)})[^${escapeString(delimiter)}])+?`;\n  };\n\n  while (i < tokens.length) {\n    const char = tryConsume(\"CHAR\");\n    const name = tryConsume(\"NAME\");\n    const pattern = tryConsume(\"PATTERN\");\n\n    if (name || pattern) {\n      let prefix = char || \"\";\n\n      if (prefixes.indexOf(prefix) === -1) {\n        path += prefix;\n        prefix = \"\";\n      }\n\n      if (path) {\n        result.push(path);\n        path = \"\";\n      }\n\n      result.push({\n        name: name || key++,\n        prefix,\n        suffix: \"\",\n        pattern: pattern || safePattern(prefix),\n        modifier: tryConsume(\"MODIFIER\") || \"\",\n      });\n      continue;\n    }\n\n    const value = char || tryConsume(\"ESCAPED_CHAR\");\n    if (value) {\n      path += value;\n      continue;\n    }\n\n    if (path) {\n      result.push(path);\n      path = \"\";\n    }\n\n    const open = tryConsume(\"OPEN\");\n    if (open) {\n      const prefix = consumeText();\n      const name = tryConsume(\"NAME\") || \"\";\n      const pattern = tryConsume(\"PATTERN\") || \"\";\n      const suffix = consumeText();\n\n      mustConsume(\"CLOSE\");\n\n      result.push({\n        name: name || (pattern ? key++ : \"\"),\n        pattern: name && !pattern ? safePattern(prefix) : pattern,\n        prefix,\n        suffix,\n        modifier: tryConsume(\"MODIFIER\") || \"\",\n      });\n      continue;\n    }\n\n    mustConsume(\"END\");\n  }\n\n  return result;\n}\n\nexport interface TokensToFunctionOptions {\n  /**\n   * When `true` the regexp will be case sensitive. (default: `false`)\n   */\n  sensitive?: boolean;\n  /**\n   * Function for encoding input strings for output.\n   */\n  encode?: (value: string, token: Key) => string;\n  /**\n   * When `false` the function can produce an invalid (unmatched) path. (default: `true`)\n   */\n  validate?: boolean;\n}\n\n/**\n * Compile a string to a template function for the path.\n */\nexport function compile<P extends object = object>(\n  str: string,\n  options?: ParseOptions & TokensToFunctionOptions,\n) {\n  return tokensToFunction<P>(parse(str, options), options);\n}\n\nexport type PathFunction<P extends object = object> = (data?: P) => string;\n\n/**\n * Expose a method for transforming tokens into the path function.\n */\nexport function tokensToFunction<P extends object = object>(\n  tokens: Token[],\n  options: TokensToFunctionOptions = {},\n): PathFunction<P> {\n  const reFlags = flags(options);\n  const { encode = (x: string) => x, validate = true } = options;\n\n  // Compile all the tokens into regexps.\n  const matches = tokens.map((token) => {\n    if (typeof token === \"object\") {\n      return new RegExp(`^(?:${token.pattern})$`, reFlags);\n    }\n  });\n\n  return (data: Record<string, any> | null | undefined) => {\n    let path = \"\";\n\n    for (let i = 0; i < tokens.length; i++) {\n      const token = tokens[i];\n\n      if (typeof token === \"string\") {\n        path += token;\n        continue;\n      }\n\n      const value = data ? data[token.name] : undefined;\n      const optional = token.modifier === \"?\" || token.modifier === \"*\";\n      const repeat = token.modifier === \"*\" || token.modifier === \"+\";\n\n      if (Array.isArray(value)) {\n        if (!repeat) {\n          throw new TypeError(\n            `Expected \"${token.name}\" to not repeat, but got an array`,\n          );\n        }\n\n        if (value.length === 0) {\n          if (optional) continue;\n\n          throw new TypeError(`Expected \"${token.name}\" to not be empty`);\n        }\n\n        for (let j = 0; j < value.length; j++) {\n          const segment = encode(value[j], token);\n\n          if (validate && !(matches[i] as RegExp).test(segment)) {\n            throw new TypeError(\n              `Expected all \"${token.name}\" to match \"${token.pattern}\", but got \"${segment}\"`,\n            );\n          }\n\n          path += token.prefix + segment + token.suffix;\n        }\n\n        continue;\n      }\n\n      if (typeof value === \"string\" || typeof value === \"number\") {\n        const segment = encode(String(value), token);\n\n        if (validate && !(matches[i] as RegExp).test(segment)) {\n          throw new TypeError(\n            `Expected \"${token.name}\" to match \"${token.pattern}\", but got \"${segment}\"`,\n          );\n        }\n\n        path += token.prefix + segment + token.suffix;\n        continue;\n      }\n\n      if (optional) continue;\n\n      const typeOfMessage = repeat ? \"an array\" : \"a string\";\n      throw new TypeError(`Expected \"${token.name}\" to be ${typeOfMessage}`);\n    }\n\n    return path;\n  };\n}\n\nexport interface RegexpToFunctionOptions {\n  /**\n   * Function for decoding strings for params.\n   */\n  decode?: (value: string, token: Key) => string;\n}\n\n/**\n * A match result contains data about the path match.\n */\nexport interface MatchResult<P extends object = object> {\n  path: string;\n  index: number;\n  params: P;\n}\n\n/**\n * A match is either `false` (no match) or a match result.\n */\nexport type Match<P extends object = object> = false | MatchResult<P>;\n\n/**\n * The match function takes a string and returns whether it matched the path.\n */\nexport type MatchFunction<P extends object = object> = (\n  path: string,\n) => Match<P>;\n\n/**\n * Create path match function from `path-to-regexp` spec.\n */\nexport function match<P extends object = object>(\n  str: Path,\n  options?: ParseOptions & TokensToRegexpOptions & RegexpToFunctionOptions,\n) {\n  const keys: Key[] = [];\n  const re = pathToRegexp(str, keys, options);\n  return regexpToFunction<P>(re, keys, options);\n}\n\n/**\n * Create a path match function from `path-to-regexp` output.\n */\nexport function regexpToFunction<P extends object = object>(\n  re: RegExp,\n  keys: Key[],\n  options: RegexpToFunctionOptions = {},\n): MatchFunction<P> {\n  const { decode = (x: string) => x } = options;\n\n  return function (pathname: string) {\n    const m = re.exec(pathname);\n    if (!m) return false;\n\n    const { 0: path, index } = m;\n    const params = Object.create(null);\n\n    for (let i = 1; i < m.length; i++) {\n      if (m[i] === undefined) continue;\n\n      const key = keys[i - 1];\n\n      if (key.modifier === \"*\" || key.modifier === \"+\") {\n        params[key.name] = m[i].split(key.prefix + key.suffix).map((value) => {\n          return decode(value, key);\n        });\n      } else {\n        params[key.name] = decode(m[i], key);\n      }\n    }\n\n    return { path, index, params };\n  };\n}\n\n/**\n * Escape a regular expression string.\n */\nfunction escapeString(str: string) {\n  return str.replace(/([.+*?=^!:${}()[\\]|/\\\\])/g, \"\\\\$1\");\n}\n\n/**\n * Get the flags for a regexp from the options.\n */\nfunction flags(options?: { sensitive?: boolean }) {\n  return options && options.sensitive ? \"\" : \"i\";\n}\n\n/**\n * Metadata about a key.\n */\nexport interface Key {\n  name: string | number;\n  prefix: string;\n  suffix: string;\n  pattern: string;\n  modifier: string;\n}\n\n/**\n * A token is a string (nothing special) or key metadata (capture group).\n */\nexport type Token = string | Key;\n\n/**\n * Pull out keys from a regexp.\n */\nfunction regexpToRegexp(path: RegExp, keys?: Key[]): RegExp {\n  if (!keys) return path;\n\n  const groupsRegex = /\\((?:\\?<(.*?)>)?(?!\\?)/g;\n\n  let index = 0;\n  let execResult = groupsRegex.exec(path.source);\n  while (execResult) {\n    keys.push({\n      // Use parenthesized substring match if available, index otherwise\n      name: execResult[1] || index++,\n      prefix: \"\",\n      suffix: \"\",\n      modifier: \"\",\n      pattern: \"\",\n    });\n    execResult = groupsRegex.exec(path.source);\n  }\n\n  return path;\n}\n\n/**\n * Transform an array into a regexp.\n */\nfunction arrayToRegexp(\n  paths: Array<string | RegExp>,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n): RegExp {\n  const parts = paths.map((path) => pathToRegexp(path, keys, options).source);\n  return new RegExp(`(?:${parts.join(\"|\")})`, flags(options));\n}\n\n/**\n * Create a path regexp from string input.\n */\nfunction stringToRegexp(\n  path: string,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n) {\n  return tokensToRegexp(parse(path, options), keys, options);\n}\n\nexport interface TokensToRegexpOptions {\n  /**\n   * When `true` the regexp will be case sensitive. (default: `false`)\n   */\n  sensitive?: boolean;\n  /**\n   * When `true` the regexp won't allow an optional trailing delimiter to match. (default: `false`)\n   */\n  strict?: boolean;\n  /**\n   * When `true` the regexp will match to the end of the string. (default: `true`)\n   */\n  end?: boolean;\n  /**\n   * When `true` the regexp will match from the beginning of the string. (default: `true`)\n   */\n  start?: boolean;\n  /**\n   * Sets the final character for non-ending optimistic matches. (default: `/`)\n   */\n  delimiter?: string;\n  /**\n   * List of characters that can also be \"end\" characters.\n   */\n  endsWith?: string;\n  /**\n   * Encode path tokens for use in the `RegExp`.\n   */\n  encode?: (value: string) => string;\n}\n\n/**\n * Expose a function for taking tokens and returning a RegExp.\n */\nexport function tokensToRegexp(\n  tokens: Token[],\n  keys?: Key[],\n  options: TokensToRegexpOptions = {},\n) {\n  const {\n    strict = false,\n    start = true,\n    end = true,\n    encode = (x: string) => x,\n    delimiter = \"/#?\",\n    endsWith = \"\",\n  } = options;\n  const endsWithRe = `[${escapeString(endsWith)}]|$`;\n  const delimiterRe = `[${escapeString(delimiter)}]`;\n  let route = start ? \"^\" : \"\";\n\n  // Iterate over the tokens and create our regexp string.\n  for (const token of tokens) {\n    if (typeof token === \"string\") {\n      route += escapeString(encode(token));\n    } else {\n      const prefix = escapeString(encode(token.prefix));\n      const suffix = escapeString(encode(token.suffix));\n\n      if (token.pattern) {\n        if (keys) keys.push(token);\n\n        if (prefix || suffix) {\n          if (token.modifier === \"+\" || token.modifier === \"*\") {\n            const mod = token.modifier === \"*\" ? \"?\" : \"\";\n            route += `(?:${prefix}((?:${token.pattern})(?:${suffix}${prefix}(?:${token.pattern}))*)${suffix})${mod}`;\n          } else {\n            route += `(?:${prefix}(${token.pattern})${suffix})${token.modifier}`;\n          }\n        } else {\n          if (token.modifier === \"+\" || token.modifier === \"*\") {\n            throw new TypeError(\n              `Can not repeat \"${token.name}\" without a prefix and suffix`,\n            );\n          }\n\n          route += `(${token.pattern})${token.modifier}`;\n        }\n      } else {\n        route += `(?:${prefix}${suffix})${token.modifier}`;\n      }\n    }\n  }\n\n  if (end) {\n    if (!strict) route += `${delimiterRe}?`;\n\n    route += !options.endsWith ? \"$\" : `(?=${endsWithRe})`;\n  } else {\n    const endToken = tokens[tokens.length - 1];\n    const isEndDelimited =\n      typeof endToken === \"string\"\n        ? delimiterRe.indexOf(endToken[endToken.length - 1]) > -1\n        : endToken === undefined;\n\n    if (!strict) {\n      route += `(?:${delimiterRe}(?=${endsWithRe}))?`;\n    }\n\n    if (!isEndDelimited) {\n      route += `(?=${delimiterRe}|${endsWithRe})`;\n    }\n  }\n\n  return new RegExp(route, flags(options));\n}\n\n/**\n * Supported `path-to-regexp` input types.\n */\nexport type Path = string | RegExp | Array<string | RegExp>;\n\n/**\n * Normalize the given path string, returning a regular expression.\n *\n * An empty array can be passed in for the keys, which will hold the\n * placeholder key descriptions. For example, using `/user/:id`, `keys` will\n * contain `[{ name: 'id', delimiter: '/', optional: false, repeat: false }]`.\n */\nexport function pathToRegexp(\n  path: Path,\n  keys?: Key[],\n  options?: TokensToRegexpOptions & ParseOptions,\n) {\n  if (path instanceof RegExp) return regexpToRegexp(path, keys);\n  if (Array.isArray(path)) return arrayToRegexp(path, keys, options);\n  return stringToRegexp(path, keys, options);\n}\n", "import { match } from \"path-to-regexp\";\n\n//note: this explicitly does not include the * character, as pages requires this\nconst escapeRegex = /[.+?^${}()|[\\]\\\\]/g;\n\ntype HTTPMethod =\n\t| \"HEAD\"\n\t| \"OPTIONS\"\n\t| \"GET\"\n\t| \"POST\"\n\t| \"PUT\"\n\t| \"PATCH\"\n\t| \"DELETE\";\n\n/* TODO: Grab these from @cloudflare/workers-types instead */\ntype Params<P extends string = string> = Record<P, string | string[]>;\n\ntype EventContext<Env, P extends string, Data> = {\n\trequest: Request;\n\tfunctionPath: string;\n\twaitUntil: (promise: Promise<unknown>) => void;\n\tpassThroughOnException: () => void;\n\tnext: (input?: Request | string, init?: RequestInit) => Promise<Response>;\n\tenv: Env & { ASSETS: { fetch: typeof fetch } };\n\tparams: Params<P>;\n\tdata: Data;\n};\n\ndeclare type PagesFunction<\n\tEnv = unknown,\n\tP extends string = string,\n\tData extends Record<string, unknown> = Record<string, unknown>,\n> = (context: EventContext<Env, P, Data>) => Response | Promise<Response>;\n/* end @cloudflare/workers-types */\n\ntype RouteHandler = {\n\troutePath: string;\n\tmountPath: string;\n\tmethod?: HTTPMethod;\n\tmodules: PagesFunction[];\n\tmiddlewares: PagesFunction[];\n};\n\n// inject `routes` via ESBuild\ndeclare const routes: RouteHandler[];\n// define `__FALLBACK_SERVICE__` via ESBuild\ndeclare const __FALLBACK_SERVICE__: string;\n\n// expect an ASSETS fetcher binding pointing to the asset-server stage\ntype FetchEnv = {\n\t[name: string]: { fetch: typeof fetch };\n\tASSETS: { fetch: typeof fetch };\n};\n\ntype WorkerContext = {\n\twaitUntil: (promise: Promise<unknown>) => void;\n\tpassThroughOnException: () => void;\n};\n\nfunction* executeRequest(request: Request) {\n\tconst requestPath = new URL(request.url).pathname;\n\n\t// First, iterate through the routes (backwards) and execute \"middlewares\" on partial route matches\n\tfor (const route of [...routes].reverse()) {\n\t\tif (route.method && route.method !== request.method) {\n\t\t\tcontinue;\n\t\t}\n\n\t\t// replaces with \"\\\\$&\", this prepends a backslash to the matched string, e.g. \"[\" becomes \"\\[\"\n\t\tconst routeMatcher = match(route.routePath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: false,\n\t\t});\n\t\tconst mountMatcher = match(route.mountPath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: false,\n\t\t});\n\t\tconst matchResult = routeMatcher(requestPath);\n\t\tconst mountMatchResult = mountMatcher(requestPath);\n\t\tif (matchResult && mountMatchResult) {\n\t\t\tfor (const handler of route.middlewares.flat()) {\n\t\t\t\tyield {\n\t\t\t\t\thandler,\n\t\t\t\t\tparams: matchResult.params as Params,\n\t\t\t\t\tpath: mountMatchResult.path,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\t// Then look for the first exact route match and execute its \"modules\"\n\tfor (const route of routes) {\n\t\tif (route.method && route.method !== request.method) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst routeMatcher = match(route.routePath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: true,\n\t\t});\n\t\tconst mountMatcher = match(route.mountPath.replace(escapeRegex, \"\\\\$&\"), {\n\t\t\tend: false,\n\t\t});\n\t\tconst matchResult = routeMatcher(requestPath);\n\t\tconst mountMatchResult = mountMatcher(requestPath);\n\t\tif (matchResult && mountMatchResult && route.modules.length) {\n\t\t\tfor (const handler of route.modules.flat()) {\n\t\t\t\tyield {\n\t\t\t\t\thandler,\n\t\t\t\t\tparams: matchResult.params as Params,\n\t\t\t\t\tpath: matchResult.path,\n\t\t\t\t};\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nexport default {\n\tasync fetch(\n\t\toriginalRequest: Request,\n\t\tenv: FetchEnv,\n\t\tworkerContext: WorkerContext\n\t) {\n\t\tlet request = originalRequest;\n\t\tconst handlerIterator = executeRequest(request);\n\t\tlet data = {}; // arbitrary data the user can set between functions\n\t\tlet isFailOpen = false;\n\n\t\tconst next = async (input?: RequestInfo, init?: RequestInit) => {\n\t\t\tif (input !== undefined) {\n\t\t\t\tlet url = input;\n\t\t\t\tif (typeof input === \"string\") {\n\t\t\t\t\turl = new URL(input, request.url).toString();\n\t\t\t\t}\n\t\t\t\trequest = new Request(url, init);\n\t\t\t}\n\n\t\t\tconst result = handlerIterator.next();\n\t\t\t// Note we can't use `!result.done` because this doesn't narrow to the correct type\n\t\t\tif (result.done === false) {\n\t\t\t\tconst { handler, params, path } = result.value;\n\t\t\t\tconst context = {\n\t\t\t\t\trequest: new Request(request.clone()),\n\t\t\t\t\tfunctionPath: path,\n\t\t\t\t\tnext,\n\t\t\t\t\tparams,\n\t\t\t\t\tget data() {\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t},\n\t\t\t\t\tset data(value) {\n\t\t\t\t\t\tif (typeof value !== \"object\" || value === null) {\n\t\t\t\t\t\t\tthrow new Error(\"context.data must be an object\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// user has overriden context.data, so we need to merge it with the existing data\n\t\t\t\t\t\tdata = value;\n\t\t\t\t\t},\n\t\t\t\t\tenv,\n\t\t\t\t\twaitUntil: workerContext.waitUntil.bind(workerContext),\n\t\t\t\t\tpassThroughOnException: () => {\n\t\t\t\t\t\tisFailOpen = true;\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tconst response = await handler(context);\n\n\t\t\t\tif (!(response instanceof Response)) {\n\t\t\t\t\tthrow new Error(\"Your Pages function should return a Response\");\n\t\t\t\t}\n\n\t\t\t\treturn cloneResponse(response);\n\t\t\t} else if (__FALLBACK_SERVICE__) {\n\t\t\t\t// There are no more handlers so finish with the fallback service (`env.ASSETS.fetch` in Pages' case)\n\t\t\t\tconst response = await env[__FALLBACK_SERVICE__].fetch(request);\n\t\t\t\treturn cloneResponse(response);\n\t\t\t} else {\n\t\t\t\t// There was not fallback service so actually make the request to the origin.\n\t\t\t\tconst response = await fetch(request);\n\t\t\t\treturn cloneResponse(response);\n\t\t\t}\n\t\t};\n\n\t\ttry {\n\t\t\treturn await next();\n\t\t} catch (error) {\n\t\t\tif (isFailOpen) {\n\t\t\t\tconst response = await env[__FALLBACK_SERVICE__].fetch(request);\n\t\t\t\treturn cloneResponse(response);\n\t\t\t}\n\n\t\t\tthrow error;\n\t\t}\n\t},\n};\n\n// This makes a Response mutable\nconst cloneResponse = (response: Response) =>\n\t// https://fetch.spec.whatwg.org/#null-body-status\n\tnew Response(\n\t\t[101, 204, 205, 304].includes(response.status) ? null : response.body,\n\t\tresponse\n\t);\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"C:\\\\Users\\\\15268\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\pages-template-worker.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"C:\\\\Users\\\\15268\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"C:\\\\Users\\\\15268\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"C:\\\\Users\\\\15268\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\pages-template-worker.ts\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"D:\\\\15268\\\\Desktop\\\\qywx-push\\\\.wrangler\\\\tmp\\\\bundle-cyJMpS\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"C:\\\\Users\\\\15268\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"D:\\\\15268\\\\Desktop\\\\qywx-push\\\\.wrangler\\\\tmp\\\\bundle-cyJMpS\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"D:\\\\15268\\\\Desktop\\\\qywx-push\\\\.wrangler\\\\tmp\\\\bundle-cyJMpS\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"D:\\\\15268\\\\Desktop\\\\qywx-push\\\\.wrangler\\\\tmp\\\\pages-8wN9vG\\\\functionsWorker-0.27857002114833507.mjs\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"C:\\\\Users\\\\15268\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"C:\\\\Users\\\\15268\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"D:\\\\15268\\\\Desktop\\\\qywx-push\\\\.wrangler\\\\tmp\\\\pages-8wN9vG\\\\functionsWorker-0.27857002114833507.mjs\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"D:\\\\15268\\\\Desktop\\\\qywx-push\\\\.wrangler\\\\tmp\\\\bundle-gY6UX1\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"C:\\\\Users\\\\15268\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"D:\\\\15268\\\\Desktop\\\\qywx-push\\\\.wrangler\\\\tmp\\\\bundle-gY6UX1\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"D:\\\\15268\\\\Desktop\\\\qywx-push\\\\.wrangler\\\\tmp\\\\bundle-gY6UX1\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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",
  "names": ["urls", "checkURL", "__name", "onRequestPost", "onRequestGet", "value", "_a", "result", "char", "prefix", "i", "drainBody", "middleware_ensure_req_body_drained_default", "reduceError", "jsonError", "middleware_miniflare3_json_error_default", "__INTERNAL_WRANGLER_MIDDLEWARE__", "middleware_ensure_req_body_drained_default", "middleware_miniflare3_json_error_default", "middleware_insertion_facade_default", "__facade_middleware__", "__facade_register__", "__facade_invokeChain__", "__facade_invoke__", "__facade_middleware__", "__Facade_ScheduledController__", "___Facade_ScheduledController__", "wrapExportedHandler", "__INTERNAL_WRANGLER_MIDDLEWARE__", "__facade_register__", "__facade_invoke__", "wrapWorkerEntrypoint", "WRAPPED_ENTRY", "middleware_insertion_facade_default", "middleware_loader_entry_default"]
}
